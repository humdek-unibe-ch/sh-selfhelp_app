<div class="llm-form-renderer" *ngIf="formDefinition">
    <!-- Form Title -->
    <div *ngIf="formDefinition.title" class="form-title">
        <h4>{{ formDefinition.title }}</h4>
    </div>

    <!-- Form Description -->
    <p *ngIf="formDefinition.description" class="form-description">
        {{ formDefinition.description }}
    </p>

    <!-- Content Before -->
    <div *ngIf="formDefinition.contentBefore" class="form-content-before">
        <app-markdown-renderer [content]="formDefinition.contentBefore"></app-markdown-renderer>
    </div>

    <!-- Form Fields -->
    <div class="form-fields">
        <ng-container *ngFor="let field of formDefinition.fields; trackBy: trackByFieldId">
            <div class="form-field" [class.has-error]="formErrors[field.id]">
                <!-- Field Label -->
                <label *ngIf="field.type !== 'hidden'" class="field-label" [for]="field.id">
                    {{ field.label }}
                    <span *ngIf="field.required" class="required-indicator">*</span>
                </label>

                <!-- Help Text -->
                <p *ngIf="field.helpText" class="field-help">{{ field.helpText }}</p>

                <!-- Radio Buttons -->
                <div *ngIf="field.type === 'radio'" class="radio-group">
                    <label *ngFor="let option of field.options; trackBy: trackByOptionValue" 
                           class="radio-option"
                           [class.selected]="isRadioSelected(field, option.value)">
                        <input 
                            type="radio"
                            [name]="field.id"
                            [value]="option.value"
                            [checked]="isRadioSelected(field, option.value)"
                            (change)="onRadioChange(field, option.value)"
                            [disabled]="isSubmitting || disabled">
                        <span class="radio-custom"></span>
                        <span class="option-label">{{ option.label }}</span>
                    </label>
                </div>

                <!-- Checkboxes -->
                <div *ngIf="field.type === 'checkbox'" class="checkbox-group">
                    <label *ngFor="let option of field.options; trackBy: trackByOptionValue" 
                           class="checkbox-option"
                           [class.selected]="isCheckboxChecked(field, option.value)">
                        <input 
                            type="checkbox"
                            [name]="field.id"
                            [value]="option.value"
                            [checked]="isCheckboxChecked(field, option.value)"
                            (change)="onCheckboxChange(field, option.value, $event)"
                            [disabled]="isSubmitting || disabled">
                        <span class="checkbox-custom"></span>
                        <span class="option-label">{{ option.label }}</span>
                    </label>
                </div>

                <!-- Select Dropdown -->
                <div *ngIf="field.type === 'select'" class="select-wrapper">
                    <select 
                        [id]="field.id"
                        [name]="field.id"
                        class="form-select"
                        [value]="formValues[field.id]"
                        (change)="onInputChange(field, $event)"
                        [disabled]="isSubmitting || disabled">
                        <option value="">{{ field.placeholder || 'Select an option...' }}</option>
                        <option *ngFor="let option of field.options; trackBy: trackByOptionValue" 
                                [value]="option.value">
                            {{ option.label }}
                        </option>
                    </select>
                    <ion-icon name="chevron-down-outline" class="select-icon"></ion-icon>
                </div>

                <!-- Text Input -->
                <input
                    *ngIf="field.type === 'text'"
                    type="text"
                    [id]="field.id"
                    [name]="field.id"
                    class="form-input"
                    [placeholder]="field.placeholder || ''"
                    [value]="formValues[field.id]"
                    [attr.maxlength]="field.maxLength"
                    (input)="onInputChange(field, $event)"
                    [disabled]="isSubmitting || disabled">

                <!-- Textarea -->
                <textarea
                    *ngIf="field.type === 'textarea'"
                    [id]="field.id"
                    [name]="field.id"
                    class="form-textarea"
                    [placeholder]="field.placeholder || ''"
                    [rows]="field.rows || 3"
                    [attr.maxlength]="field.maxLength"
                    (input)="onInputChange(field, $event)"
                    [disabled]="isSubmitting || disabled">{{ formValues[field.id] }}</textarea>

                <!-- Number Input -->
                <input 
                    *ngIf="field.type === 'number'"
                    type="number"
                    [id]="field.id"
                    [name]="field.id"
                    class="form-input"
                    [placeholder]="field.placeholder || ''"
                    [value]="formValues[field.id]"
                    [min]="field.min"
                    [max]="field.max"
                    [step]="field.step || 1"
                    (input)="onInputChange(field, $event)"
                    [disabled]="isSubmitting || disabled">

                <!-- Scale Input (rendered as range) -->
                <div *ngIf="field.type === 'scale'" class="scale-input">
                    <div class="scale-labels">
                        <span>{{ field.min || 1 }}</span>
                        <span>{{ field.max || 10 }}</span>
                    </div>
                    <input 
                        type="range"
                        [id]="field.id"
                        [name]="field.id"
                        class="form-range"
                        [min]="field.min || 1"
                        [max]="field.max || 10"
                        [step]="field.step || 1"
                        [value]="formValues[field.id] || field.min || 1"
                        (input)="onInputChange(field, $event)"
                        [disabled]="isSubmitting || disabled">
                    <div class="scale-value">
                        {{ formValues[field.id] || field.min || 1 }}
                    </div>
                </div>

                <!-- Hidden Input -->
                <input 
                    *ngIf="field.type === 'hidden'"
                    type="hidden"
                    [id]="field.id"
                    [name]="field.id"
                    [value]="field.value || ''">

                <!-- Error Message -->
                <p *ngIf="formErrors[field.id]" class="field-error">
                    <ion-icon name="alert-circle-outline"></ion-icon>
                    {{ formErrors[field.id] }}
                </p>
            </div>
        </ng-container>
    </div>

    <!-- Content After -->
    <div *ngIf="formDefinition.contentAfter" class="form-content-after">
        <app-markdown-renderer [content]="formDefinition.contentAfter"></app-markdown-renderer>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
        <ion-button 
            expand="block"
            [disabled]="isSubmitting || disabled"
            (click)="onSubmit()">
            <ion-spinner *ngIf="isSubmitting" name="crescent" slot="start"></ion-spinner>
            <span *ngIf="!isSubmitting">{{ submitLabel }}</span>
            <span *ngIf="isSubmitting">Submitting...</span>
        </ion-button>
    </div>
</div>
